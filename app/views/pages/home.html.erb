<% content_for :title, t('home.title') %>
<% content_for :description, t('home.description') %>

<section class="hero-section">
  <div class="container">
    <div class="row align-items-center">
      <!-- Hero Section - Left on desktop, top on mobile -->
      <div class="col-lg-6 col-12">
        <div class="hero-section">
          <p id="hero-intro"><%= t('home.hero.intro') %></p>
          <h1 class="hero-title"><%= t('home.hero.title') %></h1>
          <h1 class="hero-title"><%= t('home.hero.title_highlight') %> <span class="hero-title-highlight">Basketball</span>.</h1>
          <p class="intro-text"><%= t('home.hero.description') %></p>
          <div class="button-hero">
            <%= link_to t('home.hero.join_button'), new_user_registration_path, class: "button-hero-link" %>
            <%= link_to t('home.hero.login_button'), new_user_session_path, class: "button-hero-link-secondary" %>
          </div>
        </div>
      </div>

      <!-- YouTube Section - Right on desktop, bottom on mobile -->
      <div class="col-lg-6 col-12">
        <div class="youtube-section">
          <div class="youtube-container">
            <p class="youtube-description"><%= t('home.youtube.description') %></p>
            <div class="video-wrapper">
              <iframe
                width="100%"
                height="315"
                src="https://www.youtube.com/embed/NRyKucBw7DA"
                title="CourtSideClub - By hoopers for hoopers"
                frameborder="0"
                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                allowfullscreen>
              </iframe>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<section class="news-section home-news-section text-center">
  <h1 class="mb-5">Nos dernières actualités</h1>
  <div class="container">
    <!-- Desktop Layout: Carousel Bootstrap avec 4 articles par slide -->
    <div class="d-none d-lg-block">
      <div id="newsCarousel" class="carousel slide" data-bs-ride="carousel">
        <div class="carousel-inner">
          <% @latest_articles.in_groups_of(4, false).each_with_index do |group, index| %>
            <div class="carousel-item <%= 'active' if index == 0 %>">
              <div class="row g-3">
                <% group.each do |article| %>
                  <div class="col-lg-3">
                  <div class="article-card h-100">
                    <!-- Image -->
                    <%= link_to article, class: "text-decoration-none" do %>
                    <div class="article-card-image">
                                              <% if article.photo.attached? %>
                          <% if Rails.env.production? %>
                            <%= cl_image_tag article.photo.key, class: "card-img-top", alt: article.title, width: 400, height: 250, crop: :fill, gravity: :auto %>
                          <% else %>
                            <%= image_tag article.photo, class: "card-img-top", alt: article.title %>
                          <% end %>
                      <% elsif article.youtube_embed.present? %>
                        <div class="video-thumbnail">
                          <i class="fab fa-youtube"></i>
                          <span>Vidéo</span>
                        </div>
                      <% elsif article.instagram_embed.present? %>
                        <div class="video-thumbnail">
                          <i class="fab fa-instagram"></i>
                          <span>Instagram</span>
                        </div>
                      <% else %>
                        <div class="default-thumbnail">
                          <i class="fas fa-newspaper"></i>
                          <span>Article</span>
                        </div>
                      <% end %>
                    </div>

                    <!-- Content -->
                    <div class="card-body d-flex flex-column">
                      <!-- Tags -->
                      <% if article.tags.any? %>
                        <div class="article-tags mb-2">
                          <% article.tags.limit(3).each do |tag| %>
                            <span class="badge tag-badge me-1" style="background-color: <%= tag.color %>;">
                              <%= tag.name %>
                            </span>
                          <% end %>
                          <% if article.tags.count > 3 %>
                            <span class="text-muted small">+<%= article.tags.count - 3 %></span>
                          <% end %>
                        </div>
                      <% end %>

                      <!-- Title -->
                    <h5 class="article-title">
                      <%= link_to article.title, article, class: "text-decoration-none article-title-link" %>
                    </h5>

                      <!-- Excerpt -->
                      <p class="card-text text-muted small flex-grow-1">
                        <%= truncate(strip_tags(article.content), length: 120) %>
                      </p>

                      <!-- Meta -->
                      <div class="article-meta mt-auto">
                        <div class="d-flex justify-content-between align-items-center">
                          <div class="author-info">
                            <small class="text-muted">
                              <i class="fas fa-user me-1"></i>
                              <strong>CourtSideClub</strong>
                            </small>
                          </div>
                          <div class="date-info">
                            <small class="text-muted">
                              <i class="fas fa-calendar me-1"></i>
                              <%= article.published_at.strftime('%d/%m/%Y') %>
                            </small>
                          </div>
                        </div>
                      </div>
                    </div>
                    <% end %>
                  </div>
                </div>
              <% end %>
            </div>
          </div>
        <% end %>
      </div>

      <!-- Carousel Controls -->
      <% if @latest_articles.count > 4 %>
        <button class="carousel-control-prev" type="button" data-bs-target="#newsCarousel" data-bs-slide="prev">
          <span class="carousel-control-prev-icon" aria-hidden="true"></span>
          <span class="visually-hidden">Précédent</span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#newsCarousel" data-bs-slide="next">
          <span class="carousel-control-next-icon" aria-hidden="true"></span>
          <span class="visually-hidden">Suivant</span>
        </button>

        <!-- Carousel Indicators -->
        <div class="carousel-indicators">
          <% (@latest_articles.count / 4.0).ceil.times do |index| %>
            <button type="button" data-bs-target="#newsCarousel" data-bs-slide-to="<%= index %>"
                    class="<%= 'active' if index == 0 %>" aria-current="<%= index == 0 ? 'true' : 'false' %>"
                    aria-label="Slide <%= index + 1 %>"></button>
          <% end %>
        </div>
      <% end %>
      </div>
    </div>

    <!-- Mobile Layout: Carousel Bootstrap avec 1 article par slide -->
    <div class="d-lg-none">
      <div id="mobileNewsCarousel" class="carousel slide" data-bs-ride="carousel">
        <div class="carousel-inner">
          <% @latest_articles.each_with_index do |article, index| %>
            <div class="carousel-item <%= 'active' if index == 0 %>">
              <div class="row g-3">
                <div class="col-12">
                  <div class="article-card h-100">
                    <!-- Image -->
                    <%= link_to article, class: "text-decoration-none" do %>
                    <div class="article-card-image">
                      <% if article.photo.attached? %>
                        <% if Rails.env.production? %>
                          <%= cl_image_tag article.photo.key, class: "card-img-top", alt: article.title, width: 400, height: 250, crop: :fill, gravity: :auto %>
                        <% else %>
                          <%= image_tag article.photo, class: "card-img-top", alt: article.title %>
                        <% end %>
                      <% elsif article.youtube_embed.present? %>
                        <div class="video-thumbnail">
                          <i class="fab fa-youtube"></i>
                          <span>Vidéo</span>
                        </div>
                      <% elsif article.instagram_embed.present? %>
                        <div class="video-thumbnail">
                          <i class="fab fa-instagram"></i>
                          <span>Instagram</span>
                        </div>
                      <% else %>
                        <div class="default-thumbnail">
                          <i class="fas fa-newspaper"></i>
                          <span>Article</span>
                        </div>
                      <% end %>
                    </div>
                    <% end %>

                    <div class="card-body">
                      <!-- Tags -->
                      <% if article.tags.any? %>
                        <div class="article-tags">
                          <% article.tags.limit(3).each do |tag| %>
                            <span class="tag-badge" style="background-color: <%= tag.color %>;"><%= tag.name %></span>
                          <% end %>
                        </div>
                      <% end %>

                      <!-- Title -->
                      <div class="card-title">
                        <%= link_to article.title, article, class: "text-decoration-none" %>
                      </div>

                      <!-- Content -->
                      <div class="card-text">
                        <%= truncate(strip_tags(article.content), length: 100) %>
                      </div>

                      <!-- Date -->
                      <div class="article-meta">
                        <small class="text-muted">
                          <%= l(article.published_at || article.created_at, format: :short) %>
                        </small>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          <% end %>
        </div>

        <!-- Carousel Controls -->
        <% if @latest_articles.count > 1 %>
          <button class="carousel-control-prev" type="button" data-bs-target="#mobileNewsCarousel" data-bs-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="visually-hidden"><%= t('home.news.previous') %></span>
          </button>
          <button class="carousel-control-next" type="button" data-bs-target="#mobileNewsCarousel" data-bs-slide="next">
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="visually-hidden"><%= t('home.news.next') %></span>
          </button>

          <!-- Carousel Indicators -->
          <div class="carousel-indicators">
            <% @latest_articles.each_with_index do |article, index| %>
              <button type="button" data-bs-target="#mobileNewsCarousel" data-bs-slide-to="<%= index %>"
                      class="<%= 'active' if index == 0 %>" aria-current="<%= index == 0 ? 'true' : 'false' %>"
                      aria-label="Slide <%= index + 1 %>"></button>
            <% end %>
          </div>
        <% end %>
      </div>
    </div>

    <%= link_to articles_path, class: "advantages-button" do %>
      <%= t('home.news.all_news') %> <i class="fas fa-arrow-right"></i>
    <% end %>
  </div>
</section>

<section class="second-section">
  <%= link_to discover_path, class: "discover-link" do %>
    <div class="discover-courtsideclub">
      <%= t('home.discover.title') %> <br> <%= t('home.discover.subtitle') %>
    </div>
    <div class="discover-text">
      <%= t('home.discover.description') %>
    </div>
  <% end %>

  <div class="line-image">
    <div class="banner-container">
      <%= image_tag "background_courtside.jpg", alt: "CourtSide Basketball Court", class: "courtside-banner-image" %>
      <div class="banner-overlay"></div>
    </div>
  </div>
</section>

<section class="advantages-section">
  <h1><span class="hero-title-highlight"><%= t('home.advantages.title') %> </span><%= t('home.advantages.subtitle') %></h1>
  <div class="advantages-card-container">
    <%= link_to  advantages_path, class: "advantages-card" do %>
      <div class="icon">
        <i class="fas fa-crown"></i>
      </div>
      <h2><%= t('home.advantages.cards.boss.title') %></h2>
      <p><%= t('home.advantages.cards.boss.description') %></p>
      <div class="icon-bis">
        <i class="fas fa-arrow-right"></i>
      </div>
    <% end %>

    <%= link_to advantages_path, class: "advantages-card" do %>
      <div class="icon">
        <i class="fas fa-ticket-alt"></i>
      </div>
      <h2><%= t('home.advantages.cards.tickets.title') %></h2>
      <p><%= t('home.advantages.cards.tickets.description') %></p>
      <div class="icon-bis">
        <i class="fas fa-arrow-right"></i>
      </div>
    <% end %>

    <%= link_to advantages_path, class: "advantages-card" do %>
      <div class="icon">
        <i class="fas fa-handshake"></i>
      </div>
      <h2><%= t('home.advantages.cards.meetings.title') %></h2>
      <p><%= t('home.advantages.cards.meetings.description') %></p>
      <div class="icon-bis">
        <i class="fas fa-arrow-right"></i>
      </div>
    <% end %>

    <%= link_to advantages_path, class: "advantages-card" do %>
      <div class="icon">
        <i class="fas fa-basketball-ball"></i>
      </div>
      <h2><%= t('home.advantages.cards.advice.title') %></h2>
      <p><%= t('home.advantages.cards.advice.description') %></p>
      <div class="icon-bis">
        <i class="fas fa-arrow-right"></i>
      </div>
    <% end %>
  </div>
  <%= link_to advantages_path, class: "advantages-button" do %>
    <%= t('home.advantages.discover_advantages') %> <i class="fas fa-arrow-right"></i>
  <% end %>
</section>
