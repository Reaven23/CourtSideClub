
<% content_for :title, @article.title %>
<% content_for :description, truncate(strip_tags(@article.content), length: 160) %>

<div class="article-show-page">
  <div class="container-fluid">
    <div class="row">
      <!-- Article principal (75%) -->
      <div class="col-lg-9 col-12">
        <div class="article-main">
          <!-- Header de l'article -->
          <div class="article-header">
            <!-- Breadcrumb -->
            <nav aria-label="breadcrumb" class="mb-3">
              <ol class="breadcrumb">
                <li class="breadcrumb-item"><%= link_to t('articles.show.breadcrumb.home'), root_path %></li>
                <li class="breadcrumb-item"><%= link_to t('articles.show.breadcrumb.articles'), articles_path %></li>
                <li class="breadcrumb-item active" aria-current="page"><%= truncate(@article.title, length: 30) %></li>
              </ol>
            </nav>

            <!-- Titre et métadonnées -->
            <h1 class="article-title"><%= @article.title %></h1>

            <div class="article-meta">
              <div class="author-info">
                <i class="fas fa-user-circle text-primary me-2"></i>
                <strong><%= t('articles.show.meta.author') %></strong>
                <span class="text-muted ms-2">
                  <%= @article.published? ? "• #{t('articles.show.meta.published', date: @article.published_at.strftime('%d/%m/%Y'))}" : "• #{t('articles.show.meta.draft')}" %>
                </span>
              </div>

              <!-- Tags -->
              <% if @article.tags.any? %>
                <div class="article-tags mt-2">
                  <% @article.tags.each do |tag| %>
                    <span class="badge tag-badge me-1" style="background-color: <%= tag.color %>;">
                      <%= tag.name %>
                    </span>
                  <% end %>
                </div>
              <% end %>
            </div>
          </div>

          <!-- Contenu de l'article -->
          <div class="article-content">
            <!-- Photo de l'article (format paysage) -->
            <% if @article.photo.attached? %>
              <div class="article-image">
                <% if Rails.env.production? %>
                  <%= cl_image_tag @article.photo.key, class: "img-fluid", alt: @article.title, width: 800, height: 400, crop: :fill, gravity: :auto %>
                <% else %>
                  <%= image_tag @article.photo, class: "img-fluid", alt: @article.title %>
                <% end %>
              </div>
            <% end %>

            <!-- Embed Instagram -->
            <% if @article.instagram_embed.present? %>
              <div class="article-instagram">
                <div class="instagram-embed-container">
                  <blockquote class="instagram-media"
                              data-instgrm-permalink="<%= @article.instagram_embed_url %>"
                              data-instgrm-version="14">
                    <div class="instagram-placeholder">
                      <a href="<%= @article.instagram_embed_url %>" target="_blank" class="btn btn-outline-primary">
                        <i class="fab fa-instagram me-2"></i><%= t('articles.show.instagram.view_on_instagram') %>
                      </a>
                    </div>
                  </blockquote>
                </div>
              </div>
            <% end %>

            <!-- Contenu textuel -->
            <div class="article-text">
              <%= simple_format(@article.content, class: "article-body") %>
            </div>

            <!-- Vidéo YouTube (après le texte) -->
            <% if @article.youtube_embed.present? %>
              <div class="article-video">
                <h4 class="video-title">
                  <i class="fab fa-youtube text-danger me-2"></i><%= t('articles.show.video.title') %>
                </h4>
                <div class="ratio ratio-16x9">
                  <iframe src="<%= @article.youtube_embed_url %>"
                          title="#{t('articles.show.video.youtube_title')}"
                          allowfullscreen>
                  </iframe>
                </div>
              </div>
            <% end %>

            <!-- Actions -->
            <div class="article-actions">
              <div class="d-flex justify-content-between align-items-center">
                <div>
                  <%= link_to articles_path, class: "btn button-hero-link-secondary" do %>
                    <i class="fas fa-arrow-left me-2"></i><%= t('articles.show.actions.back_to_articles') %>
                  <% end %>
                </div>

                <% if user_signed_in? && @article.user == current_user %>
                  <div>
                    <% unless @article.published? %>
                      <span class="badge bg-warning"><%= t('articles.show.actions.draft_badge') %></span>
                    <% end %>
                  </div>
                <% end %>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Sidebar articles liés (25%) -->
      <div class="col-lg-3 col-12">
        <div class="article-sidebar">
          <div class="sidebar-content">
            <h5 class="sidebar-title">
              <i class="fas fa-newspaper me-2"></i><%= t('articles.show.sidebar.other_articles') %>
            </h5>

            <div class="related-articles">
              <% Article.published.where.not(id: @article.id).limit(4).each do |related_article| %>
                <div class="related-article-card">
                  <%= link_to article_path(related_article), class: "related-article-link" do %>
                    <div class="related-article-image">
                      <% if related_article.photo.attached? %>
                        <% if Rails.env.production? %>
                          <%= cl_image_tag related_article.photo.key, alt: related_article.title, width: 200, height: 120, crop: :fill, gravity: :auto %>
                        <% else %>
                          <%= image_tag related_article.photo, alt: related_article.title %>
                        <% end %>
                      <% elsif related_article.youtube_embed.present? %>
                        <div class="video-thumbnail">
                          <i class="fab fa-youtube"></i>
                          <span><%= t('articles.index.thumbnails.video') %></span>
                        </div>
                      <% elsif related_article.instagram_embed.present? %>
                        <div class="instagram-thumbnail">
                          <i class="fab fa-instagram"></i>
                          <span><%= t('articles.index.thumbnails.instagram') %></span>
                        </div>
                      <% else %>
                        <div class="default-thumbnail">
                          <i class="fas fa-newspaper"></i>
                          <span><%= t('articles.index.thumbnails.article') %></span>
                        </div>
                      <% end %>
                    </div>
                    <div class="related-article-content">
                      <h6 class="related-article-title"><%= truncate(related_article.title, length: 50) %></h6>
                      <small class="text-muted">
                        <i class="fas fa-calendar me-1"></i>
                        <%= related_article.published_at.strftime('%d/%m/%Y') %>
                      </small>
                    </div>
                  <% end %>
                </div>
              <% end %>

              <% if Article.published.where.not(id: @article.id).count == 0 %>
                <div class="no-related-articles">
                  <p class="text-muted text-center">
                    <i class="fas fa-info-circle me-2"></i>
                    <%= t('articles.show.sidebar.no_articles') %>
                  </p>
                </div>
              <% end %>
            </div>

            <!-- Lien vers tous les articles -->
            <div class="sidebar-footer">
              <%= link_to articles_path, class: "btn button-hero-link-secondary" do %>
                <i class="fas fa-th-list me-2"></i><%= t('articles.show.sidebar.view_all') %>
              <% end %>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
